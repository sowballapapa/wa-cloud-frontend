<div class="flex flex-col gap-6 max-w-sm mx-auto p-4">
  <div class="flex flex-col gap-2">
    <h2 class="text-2xl font-bold tracking-tight text-center">Vérification à deux facteurs</h2>
    <p class="text-sm text-muted-foreground text-center">
      Nous avons envoyé un code de vérification à 6 chiffres à <strong>{{ email() }}</strong>.
    </p>
  </div>

  @if (errorMessage()) {
    <div class="p-3 text-sm text-red-600 bg-red-50 rounded-md border border-red-200">
      {{ errorMessage() }}
    </div>
  }

  @if (successMessage()) {
    <div class="p-3 text-sm text-green-600 bg-green-50 rounded-md border border-green-200">
      {{ successMessage() }}
    </div>
  }

  <form [formGroup]="verifyForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">
    <div class="flex flex-col gap-1.5">
      <input
        hlmInput
        type="text"
        placeholder="123456"
        formControlName="code"
        maxlength="6"
        [class.border-red-500]="verifyForm.get('code')?.invalid && (verifyForm.get('code')?.dirty || verifyForm.get('code')?.touched)"
        class="text-center text-2xl tracking-[0.5em] font-bold h-14"
      />
      @if (verifyForm.get('code')?.touched && verifyForm.get('code')?.errors?.['pattern']) {
        <span class="text-xs text-red-500">Le code doit contenir 6 chiffres.</span>
      }
    </div>

    <button hlmBtn class="w-full bg-blue-600 hover:bg-blue-700 text-white" [disabled]="verifyForm.invalid || isLoading()">
      @if (isLoading()) {
        <ng-icon name="lucideRefreshCw" class="animate-spin mr-2" />
      }
      Vérifier
    </button>
  </form>

  <div class="flex flex-col gap-4 mt-4">
    <button hlmBtn variant="ghost" (click)="resendCode()" [disabled]="isResending()">
      @if (isResending()) {
        <ng-icon name="lucideRefreshCw" class="animate-spin mr-2" />
      }
      Renvoyer le code
    </button>

    <a routerLink="/login" class="flex items-center justify-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors">
      <ng-icon name="lucideArrowLeft" />
      Retour à la connexion
    </a>
  </div>
</div>
